<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hostel - Warden</title>
  <link rel="stylesheet" href="css/theme.css"/>
</head>
<body>
<header class="topbar">
  <div class="topbar-inner">
    <div class="brand">
      <img src="assets/logo.png" alt="SIST Logo">
      <div>
        <div class="brand-title">SIST MANAGEMENT SYSTEM</div>
        <div class="brand-sub">Hostel Approval - Warden</div>
      </div>
    </div>
    <div class="right">
      <button class="btn btn-ghost btn-mini" data-theme-toggle>Dark mode</button>
      <span class="chip"><span data-role>-</span> | <span data-who>-</span></span>
      <button class="btn btn-primary btn-mini" data-signout>Sign Out</button>
    </div>
  </div>
</header>

<div class="container">
  <div class="card">
    <div class="card-inner">
      <div class="section-title">Hostel Outpass Approval</div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Reg No</th>
              <th>Name</th>
              <th>Program</th>
              <th>Section</th>
              <th>Purpose</th>
              <th>From-To</th>
              <th>Proof</th>
              <th>Warden</th>
              <th>Chief Warden</th>
              <th>Security</th>
              <th>Final</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>

    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script src="js/common.js"></script>
<script src="js/app.js"></script>
<script>
  initThemeToggle();
  const sess = requireAuth(["WARDEN"]);
  headerBind();

  function render(){
    const list = scopeHostelForApprover(sess, Store.hostel());
    document.getElementById("rows").innerHTML = list.map(r=>`
      <tr>
        <td><b>${r.regNo}</b></td>
        <td>${r.studentName}</td>
        <td>${r.program}</td>
        <td>${r.section}</td>
        <td>${r.purpose}</td>
        <td>${r.fromDate} ${r.fromTime} â†’ ${r.toDate} ${r.toTime}</td>
        <td>${r.proofName || "-"}</td>
        <td>${statusPill(r.statusWARDEN)}</td>
        <td>${statusPill(r.statusCHIEF)}</td>
        <td>${statusPill(r.statusSECURITY)}</td>
        <td>${statusPill(r.finalStatus)}</td>
        <td style="display:flex;gap:8px;">
          <button class="btn btn-primary btn-mini" onclick="act('APPROVED','${r.id}')">Approve</button>
          <button class="btn btn-danger btn-mini" onclick="act('REJECTED','${r.id}')">Reject</button>
        </td>
      </tr>
    `).join("") || `<tr><td colspan="12" style="color:var(--muted);font-weight:900;">No pending outpass requests.</td></tr>`;
  }

  window.act = function(decision, id){
    window.actHOSTEL_WARDEN(sess, id, decision);
    toast("Updated");
    render();
  };

  render();
</script>
</body>
</html>
